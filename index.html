<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Hiragana ‚Üí Romaji Word Quiz</title>

<style>
body {
  font-family:"Hiragino Kaku Gothic Pro","Meiryo",sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:40px;
  color:#333;
  text-align:center;
}
h1 {color:#b23b3b;font-size:2em;margin-bottom:20px;}
button {
  font-size:18px;
  padding:12px 24px;
  margin:10px;
  border-radius:12px;
  cursor:pointer;
  transition:.3s;
}
#playSound {
  background:white;
  color:#b23b3b;
  border:3px solid #b23b3b;
}
#playSound:hover {background:#ffe6f2;}
.choice {
  background:#b23b3b;
  color:white;
  border:2px solid #b23b3b;
}
.choice:hover {background:#ff4da6;}
#choices {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  max-width:720px;
}
#result {
  font-size:20px;
  margin-top:20px;
  font-weight:bold;
  white-space:pre-line;
}
#gif {margin-top:20px;max-width:250px;border-radius:12px;}
#retry {
  display:none;
  background:#b23b3b;
  color:white;
  border:2px solid #b23b3b;
  margin:20px auto 0;
}
#retry:hover {background:#ff4da6;}
</style>
</head>

<body>
<h1>üéß Hiragana ‚Üí Romaji Word Quiz</h1>

<button id="playSound">‚ñ∂Ô∏è Play Sound</button>
<div id="choices"></div>
<div id="result"></div>
<img id="gif" src="" alt="" />
<button id="retry">üîÑ Retry Quiz</button>

<script>
/* ================= WORD LIST ================= */
const words = [
  {jp:"„Å®„Çâ", romaji:"tora", meaning:"lion"},
  {jp:"„Çâ„Å£„Å±", romaji:"rappa", meaning:"trumpet"},
  {jp:"„Çâ„Åè", romaji:"raku", meaning:"easy"},
  {jp:"„Çâ„Åè„Åå„Åç", romaji:"rakugaki", meaning:"doodle"},
  {jp:"„Çâ„ÅÑ„Å≠„Çì", romaji:"rainen", meaning:"next year"},
  {jp:"„Çâ„ÅÑ„Å®", romaji:"raito", meaning:"light"},
  {jp:"„Çä„Çì„Åî", romaji:"ringo", meaning:"apple"},
  {jp:"„Çä„Åô", romaji:"risu", meaning:"squirrel"},
  {jp:"„Çä„ÇÜ„ÅÜ", romaji:"riyuu", meaning:"reason"},
  {jp:"„Çä„Çá„Åì„ÅÜ", romaji:"ryokou", meaning:"travel"},
  {jp:"„Çä„Åã„ÅÑ", romaji:"rikai", meaning:"understanding"},
  {jp:"„Çä„Çá„ÅÜ", romaji:"ryou", meaning:"dormitory / quantity"},
  {jp:"„Åø„Çä„Çá„Åè", romaji:"miryoku", meaning:"appeal"},
  {jp:"„Çã„Åô", romaji:"rusu", meaning:"absence"},
  {jp:"„Åó„ÇÖ„Çã„ÅÑ", romaji:"shurui", meaning:"kind / type"},
  {jp:"„Çã„Åô„Å∞„Çì", romaji:"rusuban", meaning:"house-sitting"},
  {jp:"„Çã„Çç„ÅÜ", romaji:"rurou", meaning:"wandering"},
  {jp:"„Çå„ÅÑ", romaji:"rei", meaning:"example / zero"},
  {jp:"„Çå„ÇÇ„Çì", romaji:"remon", meaning:"lemon"},
  {jp:"„Çå„Åç„Åó", romaji:"rekishi", meaning:"history"},
  {jp:"„Çå„ÅÑ„Åû„ÅÜ„Åì", romaji:"reizoko", meaning:"refrigerator"},
  {jp:"„Çå„Çì„Åó„ÇÖ„ÅÜ", romaji:"renshuu", meaning:"practice"},
  {jp:"„Åé„Çá„ÅÜ„Çå„Å§", romaji:"gyouretsu", meaning:"row / line"},
  {jp:"„Çç„Åè", romaji:"roku", meaning:"six"},
  {jp:"„Çç„Å∞", romaji:"roba", meaning:"donkey"},
  {jp:"„Çç„ÅÜ„Åù„Åè", romaji:"rousoku", meaning:"candle"},
  {jp:"„Çç„ÅÜ„Åã", romaji:"rouka", meaning:"corridor"},
  {jp:"„Çç„Åè„Åä„Çì", romaji:"rokuon", meaning:"recording"},
  {jp:"„Çç„Åò", romaji:"roji", meaning:"alley"},
  {jp:"„Åï„Åè„Çâ", romaji:"sakura", meaning:"cherry blossom"},
  {jp:"„Åù„Çâ", romaji:"sora", meaning:"sky"},
  {jp:"„Åè„Çâ„ÅÑ", romaji:"kurai", meaning:"dark"},
  {jp:"„ÅÇ„Åã„Çã„ÅÑ", romaji:"akarui", meaning:"bright"},
  {jp:"„ÅÇ„Çâ„Åó", romaji:"arashi", meaning:"storm"},
  {jp:"„Åã„Çâ„Å¶", romaji:"karate", meaning:"karate"},
  {jp:"„ÇÄ„Çâ", romaji:"mura", meaning:"village"},
  {jp:"„Å¶„Çâ", romaji:"tera", meaning:"temple"},
  {jp:"„ÅØ„Çâ", romaji:"hara", meaning:"belly / field"},
  {jp:"„Åã„Çå", romaji:"kare", meaning:"him"},
  {jp:"„Åè„Å§„Çç„Åí„Çã", romaji:"kutsurogeru", meaning:"to relax"},
  {jp:"„Çç„Çì„Çä", romaji:"ronri", meaning:"theory"},
  {jp:"„Åï„Çã", romaji:"saru", meaning:"monkey"},
  {jp:"„Åæ„Å§„Çä", romaji:"matsuri", meaning:"festival"},
  {jp:"„Çä„ÇÇ„Åì„Çì", romaji:"rimokon", meaning:"remote control"},
  {jp:"„Åï„Çâ", romaji:"sara", meaning:"plate"},
  {jp:"„Å≤„Çâ„Åå„Å™", romaji:"hiragana", meaning:"hiragana"},
  {jp:"„Å™„Åä„Çã", romaji:"naoru", meaning:"to fix, to get better"}
];

/* ================= DISTRACTOR ENGINE ================= */
const yoonMap = {
  "„Åç„ÇÉ":"„Åç„ÇÑ","„Åç„ÇÖ":"„Åç„ÇÜ","„Åç„Çá":"„Åç„Çà",
  "„Åó„ÇÉ":"„Åó„ÇÑ","„Åó„ÇÖ":"„Åó„ÇÜ","„Åó„Çá":"„Åó„Çà",
  "„Å°„ÇÉ":"„Å°„ÇÑ","„Å°„ÇÖ":"„Å°„ÇÜ","„Å°„Çá":"„Å°„Çà",
  "„Çä„ÇÉ":"„Çä„ÇÑ","„Çä„ÇÖ":"„Çä„ÇÜ","„Çä„Çá":"„Çä„Çà"
};

const dakutenMap = {
  "„Åã":"„Åå","„Åå":"„Åã","„Åï":"„Åñ","„Åñ":"„Åï","„Åü":"„Å†","„Å†":"„Åü",
  "„ÅØ":"„Å∞","„Å∞":"„ÅØ","„Å±":"„ÅØ","„Å§":"„Å•","„Å•":"„Å§","„Åó":"„Åò","„Åò":"„Åó"
};

function generateDistractors(correctJP){
  const set = new Set();

  // y≈çon confusion
  for(const y in yoonMap){
    if(correctJP.includes(y)) set.add(correctJP.replace(y, yoonMap[y]));
  }

  // dakuten confusion
  for(const k in dakutenMap){
    if(correctJP.includes(k)) set.add(correctJP.replace(k, dakutenMap[k]));
  }

  // small „Å£ insertion
  if(correctJP.includes("„Å§")) set.add(correctJP.replace("„Å§","„Å£„Å§"));

  // vowel shortening
  set.add(correctJP.replace("„ÅÜ",""));

  // fallback random kana noise
  while(set.size < 3){
    set.add(correctJP.slice(0,-1)+"„ÅÇ");
  }

  return [...set].slice(0,3);
}

/* ================= QUIZ LOGIC ================= */
let currentWord;
let score = 0;
let count = 0;
const maxQuestions = 25;

const choicesDiv = document.getElementById("choices");
const resultEl = document.getElementById("result");
const gifEl = document.getElementById("gif");
const playSoundBtn = document.getElementById("playSound");
const retryBtn = document.getElementById("retry");

function newQuestion(){
  if(count >= maxQuestions) return endQuiz();
  count++;

  currentWord = words[Math.floor(Math.random()*words.length)];
  choicesDiv.innerHTML = "";

  const distractors = generateDistractors(currentWord.jp);
  const options = [...distractors, currentWord.jp].sort(()=>Math.random()-0.5);

  options.forEach(opt=>{
    const btn = document.createElement("button");
    btn.className="choice";
    btn.textContent=opt;
    btn.onclick=()=>checkAnswer(opt);
    choicesDiv.appendChild(btn);
  });

  resultEl.textContent =
    `Q ${count} / ${maxQuestions}\nChoose the correct hiragana`;
}

function checkAnswer(ans){
  if(ans === currentWord.jp){
    score++;
    resultEl.textContent =
`‚≠ï Correct!
${currentWord.jp} ‚Äî ${currentWord.romaji}
Meaning: ${currentWord.meaning}`;
  } else {
    resultEl.textContent =
`‚ùå Wrong!
Correct: ${currentWord.jp}
Romaji: ${currentWord.romaji}
Meaning: ${currentWord.meaning}`;
  }
  setTimeout(newQuestion, 1600);
}

function endQuiz(){
  choicesDiv.innerHTML="";
  let gif="", text="";
  if(score>=21){
    text="üåü Excellent!";
    gif="https://raw.githubusercontent.com/k58835032-notbot/lesson-9-morae/main/cool%20cute%20cat.gif";
  } else if(score>=12){
    text="üëç Good job!";
    gif="https://raw.githubusercontent.com/k58835032-notbot/lesson-9-morae/main/cute%20cat%20walking.gif";
  } else {
    text="üå± Keep practicing!";
    gif="https://raw.githubusercontent.com/k58835032-notbot/lesson-9-morae/main/sad%20cute%20cat.gif";
  }

  resultEl.textContent = `${text}\nScore: ${score} / ${maxQuestions}`;
  gifEl.src = gif;
  playSoundBtn.disabled = true;
  retryBtn.style.display="block";
}

function resetQuiz(){
  score=0;
  count=0;
  gifEl.src="";
  retryBtn.style.display="none";
  playSoundBtn.disabled=false;
  newQuestion();
}

/* audio placeholder */
function playCurrentSound(){}

playSoundBtn.onclick = playCurrentSound;
retryBtn.onclick = resetQuiz;

newQuestion();
</script>
</body>
</html>
